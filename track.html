<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MZJ â€” ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ø·Ù„Ø¨</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
<style>
:root{ --brown:#3e2420; --beige:#bc8f74; --cream:#fff8ef; --text:#1f2937; --muted:#6b7280; --radius:14px; --shadow:0 8px 28px rgba(0,0,0,.08); }
*{box-sizing:border-box}
body{margin:0;background:var(--cream);color:var(--text);font-family:"Tajawal",system-ui,Arial;line-height:1.75}
.wrap{max-width:1100px;margin:24px auto;padding:0 16px}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:14px;background:#fff;border:1px solid #eadbcf;border-radius:var(--radius);box-shadow:var(--shadow)}
.logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--brown),#2a1714);color:#fff;display:grid;place-items:center;font-weight:900}
h1{margin:0;font-size:18px;color:var(--brown)}
.card{background:#fff;border:1px solid #eadbcf;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-top:16px}
.row{display:flex;gap:8px;flex-wrap:wrap}
input{padding:10px 12px;border:1px solid #eadbcf;border-radius:10px;background:#fff}
button{border:1px solid #eadbcf;background:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800}
button.primary{background:var(--brown);border-color:var(--brown);color:#fff}
.muted{color:var(--muted)}
.timeline{display:flex;gap:10px;overflow:auto;padding:8px 2px}
.step{min-width:200px;background:#fff;border:1px solid #eadbcf;border-radius:12px;padding:10px}
.step .t{font-weight:800}
.step .m{font-size:12px;color:var(--muted)}
.step.active{border-color:var(--beige);box-shadow:0 0 0 2px rgba(188,143,116,.12)}
.step.done{opacity:.95}
.strip{height:3px;background:repeating-linear-gradient(90deg,#e8d8cb 0 24px,#f7eee7 24px 48px);border-radius:999px;margin-bottom:8px}
.grid{display:grid;gap:16px}
@media(min-width:900px){ .grid-2{grid-template-columns:2fr 1fr} }
.small{font-size:13px}
.pill{display:inline-flex;gap:8px;align-items:center;background:#fff6ef;border:1px solid #ffe3cc;color:#9a5c2b;padding:8px 10px;border-radius:10px;font-size:13px;margin-bottom:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div style="display:flex;gap:10px;align-items:center">
      <div class="logo">â˜…</div>
      <div>
        <h1>MZJ â€” ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ø·Ù„Ø¨</h1>
        <div class="muted small">Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©</div>
      </div>
    </div>
    <a href="sales.html" class="small muted">Ù„ÙˆØ­Ø© ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª â†—</a>
  </div>

  <div class="card">
    <div class="row">
      <input id="orderInput" placeholder="Ù…Ø«Ø§Ù„: ORD-2025-001" />
      <button class="primary" id="btnShow">Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©</button>
    </div>
    <div class="muted small" id="msg" style="margin-top:8px"></div>
  </div>

  <div class="grid grid-2">
    <div class="card">
      <div class="strip"></div>
      <div id="timeline" class="timeline"></div>
    </div>
    <div class="card">
      <div class="pill" id="currentPill">â€”</div>
      <div id="nextTitle" style="font-weight:800;margin-bottom:4px">â€”</div>
      <div class="muted" id="nextDesc">â€”</div>
      <div class="muted" id="meta" style="margin-top:10px;font-size:13px">â€”</div>
    </div>
  </div>

  <div class="card">
    <div style="font-weight:800;margin-bottom:6px">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
    <div id="notes" class="muted">â€”</div>
  </div>
</div>

<script>
// â€”â€” Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Function Ø§Ù„Ø¹Ø§Ù…Ø© â€” ØºÙŠÙ‘Ø±Ù‡ Ø¨Ø±Ø§Ø¨Ø· Ù…Ø´Ø±ÙˆØ¹Ùƒ:
const PUBLIC_FN = "https://<REGION>-<PROJECT_ID>.cloudfunctions.net/getPublicOrder";

const STAGES = [
  {k:'ORDER_CREATED',      t:'1) ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ (Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù‡Ù…)'},
  {k:'PAYMENT_ORDER',      t:'2) Ø£Ù…Ø± Ø§Ù„Ø¯ÙØ¹ (ØªØ­ÙˆÙŠÙ„/Ø´Ø¨ÙƒØ©/ÙƒØ§Ø´)'},
  {k:'CUSTOMER_SERVICE',   t:'3) ØªÙˆØ§ØµÙ„ Ù…Ù…Ø«Ù„ÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ + Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©'},
  {k:'FEES_PAYMENT',       t:'4) Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…'},
  {k:'INSURANCE_LINK',     t:'5) Ø§Ù„ØªØ£Ù…ÙŠÙ† (Ø´Ø±Ø· Ø§Ù„Ø±Ø¨Ø· Ø¹Ù„Ù‰ Ø³ÙŠØ³ØªÙ… Ø§Ù„Ù…Ù…Ù„ÙƒØ©)'},
  {k:'DOCS_CLEARANCE',     t:'6) Ø§Ø³ØªÙŠÙØ§Ø¡ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ ÙˆØ§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©'},
  {k:'CUSTOMS_TRANSFER',   t:'7) ØªØ¬ÙŠÙŠØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©'},
  {k:'PLATES_OR_OWNERSHIP',t:'8) Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù„ÙˆØ­Ø§Øª Ø£Ùˆ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙƒÙŠØ©'},
  {k:'READY_OR_SHIPPING',  t:'9) Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø£Ùˆ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†'},
  {k:'DELIVERED',          t:'10) Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­'}
];

function labelOf(k){ const f=STAGES.find(s=>s.k===k); return f?f.t:k; }

function render(data){
  const tl = document.getElementById('timeline');
  tl.innerHTML = '';
  const idx = (data.statusIndex||1)-1;
  STAGES.forEach((s,i)=>{
    const div = document.createElement('div');
    div.className = 'step '+(i<idx?'done ':'')+(i===idx?'active':'');
    div.innerHTML = `<div class="t">${s.t}</div><div class="m">${i===idx?'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©':''}&nbsp;</div>`;
    tl.appendChild(div);
  });
  document.getElementById('currentPill').innerText = 'Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ' + labelOf(data.status);
  // ØªÙˆØµÙŠØ© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„
  const nextMap = {
    'ORDER_CREATED': 'Ø³ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ ÙØ±ÙŠÙ‚Ù†Ø§ Ù„Ø¥ØµØ¯Ø§Ø± Ø£Ù…Ø± Ø§Ù„Ø¯ÙØ¹.',
    'PAYMENT_ORDER': 'ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©.',
    'CUSTOMER_SERVICE': 'Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ© Ù„Ùƒ.',
    'FEES_PAYMENT': 'Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª.',
    'INSURANCE_LINK': 'Ø¬Ø§Ø±Ù Ø±Ø¨Ø· Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø¹Ù„Ù‰ Ø³ÙŠØ³ØªÙ… Ø§Ù„Ù…Ù…Ù„ÙƒØ©.',
    'DOCS_CLEARANCE': 'ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø£ÙŠ Ù…Ø³ØªÙ†Ø¯Ø§Øª/Ù…Ø¨Ø§Ù„Øº Ù…ØªØ¨Ù‚ÙŠØ©.',
    'CUSTOMS_TRANSFER': 'ØªØ¬Ù‡ÙŠÙ€Ø±/ØªØ¬ÙŠÙŠØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©.',
    'PLATES_OR_OWNERSHIP': 'Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù„ÙˆØ­Ø§Øª Ø£Ùˆ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙƒÙŠØ©.',
    'READY_OR_SHIPPING': 'Ø³ÙŠØ§Ø±ØªÙƒ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø£Ùˆ Ø§Ù„Ø´Ø­Ù†.',
    'DELIVERED': 'Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰'
  };
  document.getElementById('nextTitle').innerText = 'Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©';
  document.getElementById('nextDesc').innerText = nextMap[data.status] || 'â€”';
  const dt = data.meta?.updatedAt ? new Date(data.meta.updatedAt).toLocaleString('ar-SA') : 'â€”';
  document.getElementById('meta').innerText = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${dt}`;
  document.getElementById('notes').innerText = data.notes || 'â€”';
}

document.getElementById('btnShow').addEventListener('click', async ()=>{
  const orderNumber = document.getElementById('orderInput').value.trim();
  const msg = document.getElementById('msg');
  if(!orderNumber){ msg.innerText = 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨.'; return; }
  msg.innerText = '...Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©';
  try{
    const url = `${PUBLIC_FN}?orderNumber=${encodeURIComponent(orderNumber)}`;
    const res = await fetch(url);
    const data = await res.json();
    if(!res.ok){ msg.innerText = data.error || 'ØªØ¹Ø°Ù‘Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©'; return; }
    msg.innerText = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨: ${data.orderNumber}`;
    render(data);
  }catch(e){
    console.error(e); msg.innerText = 'Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.';
  }
});
</script>
</body>
</html>
